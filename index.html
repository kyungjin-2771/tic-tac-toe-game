<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>5Ã—5 ë§¤ì¹­ ì¹´ë“œê²Œì„ â€” ë‹¨ì¼ í˜ì´ì§€</title>
<style>
  body{margin:0;font-family:system-ui;background:#f8fafc;color:#0f172a}
  .wrap{max-width:900px;margin:0 auto;padding:20px}
  textarea{width:100%;height:160px}
  .grid{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;max-width:760px;margin:0 auto}
  .tile{aspect-ratio:1/1;border:1px solid #cbd5e1;border-radius:10px;display:flex;align-items:center;justify-content:center}
  .tile.open{background:#fff}
  .tile.matched{opacity:.25}
  .face{font-weight:700}
  .share{margin-top:10px;padding:10px;border:1px dashed #aaa;border-radius:10px;background:#fff;display:none}
  .share input{width:100%;font-family:monospace;padding:6px}
</style>
</head>
<body>
<div class="wrap">
  <h1>5Ã—5 ë§¤ì¹­ ì¹´ë“œê²Œì„</h1>
  <button id="btnShare">ë§í¬ ë§Œë“¤ê¸°</button>
  <button id="btnReset">ì²˜ìŒìœ¼ë¡œ</button>

  <section id="setup">
    <p>í•œ ì¤„ì— ì‘í’ˆëª…,ì´ë¯¸ì§€URL í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš”. (ì˜ˆ: ëª¨ë„¤ - ìˆ˜ë ¨ì—°ëª»,https://i.imgur.com/xU5lhcz.png)</p>
    <textarea id="ta"></textarea>
    <button id="btnStart">ê²Œì„ ì‹œì‘</button>
    <button id="btnSample">ìƒ˜í”Œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
    <div id="msg"></div>
    <div id="shareBox" class="share">
      <p>ì•„ë˜ ë§í¬ë¥¼ ë³µì‚¬í•´ì„œ í•™ìƒì—ê²Œ ë³´ë‚´ì„¸ìš”:</p>
      <input id="shareInput" readonly>
      <button id="btnCopy">ë³µì‚¬</button>
      <button id="btnOpen">ì—´ì–´ë³´ê¸°</button>
      <div id="shareStatus"></div>
    </div>
  </section>

  <section id="game" hidden>
    <div>ë’¤ì§‘íŒ ì¹´ë“œ: <span id="openCount">0</span>/2 | ë‚¨ì€ ì¹´ë“œ: <span id="leftCount">25</span></div>
    <div id="grid" class="grid"></div>
    <div id="win" hidden>ğŸ‰ ëª¨ë“  ì¹´ë“œë¥¼ ì œê±°í–ˆìŠµë‹ˆë‹¤!</div>
  </section>
</div>
<script>
(function(){
  const $=s=>document.querySelector(s);
  const ta=$('#ta'), btnStart=$('#btnStart'), btnSample=$('#btnSample'), btnShare=$('#btnShare'), btnReset=$('#btnReset');
  const msg=$('#msg'), grid=$('#grid'), openCount=$('#openCount'), leftCount=$('#leftCount'), setup=$('#setup'), game=$('#game'), win=$('#win');
  const shareBox=$('#shareBox'), shareInput=$('#shareInput'), btnCopy=$('#btnCopy'), btnOpen=$('#btnOpen'), shareStatus=$('#shareStatus');

  let board=[], disabled=false;

  function parse(raw){ return raw.split(/\n/).map(l=>l.trim()).filter(Boolean).map((line,i)=>{const [t,img]=line.split(/[,|]/).map(s=>(s||'').trim());return {id:'p'+i,text:t,image:img};}); }

  btnStart.onclick=()=>{const pairs=parse(ta.value); if(pairs.length<12){msg.textContent='12ìŒ ì´ìƒ í•„ìš”í•©ë‹ˆë‹¤.';return;} start(pairs.slice(0,12));};

  function start(pairs){ let cards=[]; pairs.forEach((p,i)=>{cards.push({id:p.id,type:'text',face:p.text,matched:false,flipped:false});cards.push({id:p.id,type:'image',face:p.image,matched:false,flipped:false});});cards.push({id:'free',type:'free',face:'â­',matched:false,flipped:false}); board=shuffle(cards); setup.hidden=true; game.hidden=false; render(); }

  function render(){ grid.innerHTML=''; board.forEach((c,i)=>{const b=document.createElement('button');b.className='tile'+(c.flipped||c.matched?' open':'')+(c.matched?' matched':'');b.disabled=c.matched;b.onclick=()=>flip(i);if(c.flipped||c.matched){if(c.type==='image'){const img=document.createElement('img');img.src=c.face;img.style.maxWidth='100%';img.style.maxHeight='100%';b.appendChild(img);}else{b.textContent=c.face;}} else b.textContent='?'; grid.appendChild(b);}); openCount.textContent=board.filter(c=>c.flipped&&!c.matched).length; leftCount.textContent=board.filter(c=>!c.matched).length; if(board.every(c=>c.matched)) win.hidden=false; }

  function flip(i){ if(disabled) return; const c=board[i]; if(c.flipped||c.matched) return; c.flipped=true; render(); if(c.type==='free'){c.matched=true; render(); return;} const open=board.filter(x=>x.flipped&&!c.matched); if(open.length===2){ disabled=true; setTimeout(()=>{const[a,b]=open; if(a.id===b.id&&a.type!==b.type){a.matched=b.matched=true;} else {a.flipped=b.flipped=false;} disabled=false; render();},500);} }

  function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}

  // ë§í¬ ë§Œë“¤ê¸°/ë³µì‚¬
  btnShare.onclick=()=>{
    const data=b64EncodeUtf8(ta.value||'');
    // baseURIê°€ srcdoc/nullì´ë©´ ì‚¬ìš©ìê°€ ì§ì ‘ URL ì œê³µ
    let base;
    if(/^about:|^null/.test(document.baseURI)||location.origin==='null'){
      base=prompt('ë°°í¬í•  ê¸°ë³¸ URLì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: https://example.com/game.html)', '');
      if(!base) return;
    } else {
      base=(location.origin+location.pathname);
    }
    const url=base+'#data='+data;
    shareInput.value=url;
    shareBox.style.display='block';
    shareStatus.textContent='';
  };

  btnCopy.onclick=()=>{ shareInput.select(); document.execCommand('copy'); shareStatus.textContent='âœ… ë³µì‚¬ë¨'; };
  btnOpen.onclick=()=>{ window.open(shareInput.value,'_blank'); };

  (function loadFromHash(){ const m=location.hash.match(/data=([^&]+)/); if(!m) return; try{ const decoded=b64DecodeUtf8(m[1]); ta.value=decoded; const ps=parse(decoded); if(ps.length>=12) start(ps.slice(0,12)); else msg.textContent='ë§í¬ ë°ì´í„°ê°€ 12ìŒ ë¯¸ë§Œì…ë‹ˆë‹¤.'; }catch(e){ alert('ë§í¬ ë°ì´í„° í•´ì„ ì‹¤íŒ¨'); }})();

  btnSample.onclick=()=>{ ta.value=`ëª¨ë„¤ - ìˆ˜ë ¨ì—°ëª»,https://i.imgur.com/xU5lhcz.png\në¥´ëˆ„ì•„ë¥´ - í”¼ì•„ë…¸ì•ì˜ ì†Œë…€ë“¤,https://i.imgur.com/h5zsepu.png\në£¨ë²¤ìŠ¤ - ì‚¬ìêµ´ì†ì˜ ë‹¤ë‹ˆì—˜,https://i.imgur.com/rh2TGY4.png\në³´í…Œë¡œ - ëª¨ë‚˜ë¦¬ì,https://i.imgur.com/P182N4A.png\në­‰í¬ - ì ˆê·œ,https://i.imgur.com/Fo2p9Kj.png\në“œê°€ - ë…¹ìƒ‰ì˜·ì˜ ë¬´ìš©ìˆ˜,https://i.imgur.com/83AL8rX.png\në¡œë… - ìƒê°í•˜ëŠ” ì‚¬ëŒ,https://i.imgur.com/aNrsGSr.png\në ˜ë¸Œë€íŠ¸ - ìí™”ìƒ,https://i.imgur.com/OlLuThl.png\nëª¨ë„¤ - í–‡ë¹›ì†ì˜ ê±´ì´ˆë”ë¯¸,https://i.imgur.com/eq9b6xw.png\në°˜ê³ í - ì˜¤ë² ë¥´ì˜ êµíšŒ,https://i.imgur.com/gkQYxX4.png\në’¤ëŸ¬ - í•˜ì„¸,https://i.imgur.com/uOt0lmF.png\ní”„ë¦¬ë‹¤ ì¹¼ë¡œ - ì›ìˆ­ì´ê°€ ìˆëŠ” ìí™”ìƒ,https://i.imgur.com/0N1m0nK.png`; };
  btnReset.onclick=()=>{ setup.hidden=false; game.hidden=true; win.hidden=true; };

  function b64EncodeUtf8(str){ return btoa(unescape(encodeURIComponent(str))); }
  function b64DecodeUtf8(b64){ return decodeURIComponent(escape(atob(b64))); }
})();
</script>
</body>
</html>
